å…ˆæŠŠç»“è®ºä¸¢ç»™ä½ ï¼š

> **æ˜¯çš„ï¼Œæ¥ä¸‹æ¥æœ€æ ¸å¿ƒçš„äº‹ï¼Œå°±æ˜¯ï¼š
> åœ¨ LLVM IR å±‚é¢ï¼ŒæŠŠâ€œè‡ªå·±å†™çš„ OLLVM æ··æ·† Passâ€ç»Ÿç»Ÿ *å* æ‰ã€‚
> ä¹Ÿå°±æ˜¯ï¼šIR æ··æ·† â†’ IR åæ··æ·† â†’ è¯­ä¹‰è¿˜åŸã€‚**

ä½ ç°åœ¨è¦çš„æ˜¯ä¸€ä»½ **ç³»ç»Ÿè§„åˆ’ + ç»å…¸ OLLVM / LLVM æ··æ·†æ‰‹æ®µç›˜ç‚¹**ï¼Œå¸®ä½ æŠŠé VMP çš„ä¸œè¥¿åƒé€ï¼Œä¸ºä¹‹åä¸Š VMP é“ºè·¯ã€‚ä¸‹é¢æˆ‘æŒ‰â€œé˜¶æ®µ + æ¸…å•â€ç»™ä½ æ•´ç†ã€‚

---

## ğŸ§­ æ€»ä½“è·¯çº¿å›¾ï¼ˆä» OLLVM åˆ° VMPï¼‰

åˆ† 3 å¤§é˜¶æ®µï¼š

1. **LLVM IR é˜¶æ®µï¼šOLLLVM ç»å…¸æ··æ·† + åæ··æ·† Pass**
2. **æ‰©å±•æ··æ·†é˜¶æ®µï¼šå­—ç¬¦ä¸²/å¸¸é‡/MBA/æŠ—è°ƒè¯• ç­‰ LLVM æ··æ·† + åæ··æ·†**
3. **Binary è§†è§’è¿‡æ¸¡ï¼šæŠŠ IR æ··æ·†æŠ•å°„åˆ°äºŒè¿›åˆ¶ä¸–ç•Œï¼Œä¸º VMP åšå‡†å¤‡**

ä½ çœŸæ­£å¼€å§‹ç¢° VMP æ—¶ï¼Œè¿™äº›éƒ½ä¼šå˜æˆâ€œè‚Œè‚‰è®°å¿†â€ã€‚

---

## ğŸ¥‡ é˜¶æ®µä¸€ï¼šç»å…¸ OLLVM Pass + åæ··æ·†ï¼ˆå¿…ä¿®ï¼‰

åŸå§‹çš„ Obfuscator-LLVMï¼ˆJunod é‚£ç¯‡è®ºæ–‡ï¼‰å’Œå®˜æ–¹å®ç°ï¼Œæ ¸å¿ƒæ˜¯ **3 ä¸ª pass**ï¼š([Pascal Junod][1])

> **CFFï¼ˆControl Flow Flatteningï¼‰
> BCFï¼ˆBogus Control Flowï¼‰
> SUBï¼ˆInstruction Substitutionï¼‰**

å†åŠ ä¸Šè®ºæ–‡é‡Œæåˆ°ä½†ä¸å¼€æºçš„ï¼š

* Procedure Mergingï¼ˆå‡½æ•°åˆå¹¶ï¼‰
* Basic-block Splittingï¼ˆåŸºæœ¬å—æ‹†åˆ†ï¼‰
* Tamper-proofing / Integrity Checksï¼ˆå®Œæ•´æ€§æ ¡éªŒï¼‰([Pascal Junod][1])

ä½ å¯ä»¥æŒ‰ä¸‹é¢è¿™ä¸ª checklist æ¥åšï¼ˆæ¯ä¸€é¡¹éƒ½æ˜¯â€œæ··æ·† + åæ··æ·†â€æˆå¯¹å‡ºç°ï¼‰ï¼š

---

### 1ï¸âƒ£ Control Flow Flatteningï¼ˆæ§åˆ¶æµå¹³å¦åŒ– / çŠ¶æ€æœºåŒ–ï¼‰

**ç›®æ ‡ï¼š** æŠŠä¸€ä¸ªæ­£å¸¸ CFG å˜æˆ â€œwhile(1)+switch(state)â€ çš„çŠ¶æ€æœºã€‚([Obfuscator][2])

* âœ… æ··æ·† Pass è¦åšçš„äº‹ï¼š

  * æ”¶é›†ä¸€ä¸ªå‡½æ•°é‡Œçš„æ‰€æœ‰åŸºæœ¬å—
  * å»ºä¸€ä¸ª dispatcher/backboneï¼ˆ`while` or `loop`ï¼‰
  * ç”¨ `switch(state)` æˆ– if é“¾è·³åˆ°å„ä¸ªåŸå§‹å—
  * æ¯ä¸ªåŸå§‹å—æœ«å°¾è®¾ç½®ä¸‹ä¸€ä¸ª stateï¼Œå†å›åˆ° dispatcher

* âœ… åæ··æ·† Pass è¦åšçš„äº‹ï¼š

  * è¯†åˆ« dispatcher + state å˜é‡
  * åˆ†æ â€œstate â†’ target BBâ€ çš„æ˜ å°„ï¼ˆæ¢å¤çœŸå® CFGï¼‰
  * åˆ æ‰ dispatcherï¼Œæ¢å¤ç›´æ¥ `br` / `cond br`
  * æ¸…ç†å¤šä½™å˜é‡ï¼Œåšä¸€æ¬¡ `simplifycfg + dce`

**å»ºè®®ï¼š**
å…ˆæä¸€ä¸ª *æœ€ç®€ CFF* å®ç°ï¼Œå†å†™ä¸€ä¸ª de-CFF Passï¼Œåªè¦èƒ½æŠŠè‡ªå·±çš„ CFF å®Œå…¨è¿˜åŸï¼Œä½ å°±è¿‡å…³ã€‚

---

### 2ï¸âƒ£ Bogus Control Flowï¼ˆè™šå‡æ§åˆ¶æµ / Opaque Predicateï¼‰([GitHub][3])

**ç›®æ ‡ï¼š** æ’å…¥â€œçœ‹èµ·æ¥æœ‰åˆ†æ”¯ï¼Œå®é™…ä¸Šæ’çœŸ/æ’å‡çš„æ¡ä»¶â€ã€‚

* âœ… æ··æ·† Passï¼š

  * åœ¨æŸäº›åŸºæœ¬å—å‰æ’å…¥æ–°çš„ BBï¼š

    * æ„é€ å¤æ‚è¡¨è¾¾å¼ `opaque(x)`ï¼Œä½†é€»è¾‘ä¸Šæ’ true/false
    * `br i1 %opaque, label %real, label %clone`
  * å…‹éš†åŸå§‹ BBï¼Œå¾€é‡Œå¡ junk æŒ‡ä»¤ï¼Œè®© CFG çœ‹èµ·æ¥æ›´ä¹±

* âœ… åæ··æ·† Passï¼š

  * å¯¹æ¡ä»¶åšå¸¸é‡/ç¬¦å·åˆ†æï¼Œåˆ¤æ–­æ˜¯å¦æ’çœŸ/æ’å‡
  * ä¿ç•™çœŸå®åˆ†æ”¯ï¼Œä¸¢æ‰ bogus block
  * æ¸…ç†ä¸å¯è¾¾ä»£ç ã€æ­»ä»£ç ã€phi

è¿™ä¸€æ­¥ä¼šè®©ä½ ç†Ÿæ‚‰ï¼š

* å¸¸é‡ä¼ æ’­ã€ç®€å•ç¬¦å·æ‰§è¡Œ
* `DominatorTree`, `PostDominatorTree` çš„ç”¨æ³•

---

### 3ï¸âƒ£ Instruction Substitution / MBAï¼ˆæŒ‡ä»¤æ›¿æ¢ / ç®—æœ¯è¡¨è¾¾å¼å˜å½¢ï¼‰

åŸ OLLVM ä¸­æ˜¯æŠŠç®€å•ç®—æœ¯æ¢æˆç­‰ä»·å¤æ‚è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼š([Pascal Junod][1])

* `a + b` â†’ `(a ^ b) + 2*(a & b)`
* `a - b` â†’ `(a ^ (~b)) + 2*(a & (~b))`

**ä½ å¯ä»¥è¿™æ ·å®‰æ’ï¼š**

* âœ… æ··æ·† Passï¼š

  * é’ˆå¯¹åŠ /å‡/å¼‚æˆ–/æ¯”è¾ƒç­‰ï¼Œåšæ¨¡å¼æ›¿æ¢ï¼š

    * ç”¨ MBAï¼ˆMixed Boolean-Arithmeticï¼‰å…¬å¼æ›¿æ¢
    * æˆ–æ’å…¥å¤šä½™ä¸­é—´è¿ç®—ï¼Œå†åˆå¹¶

* âœ… åæ··æ·† Passï¼š

  * ç”¨â€œæ¨¡å¼åŒ¹é… + ç®€å•ç¬¦å·æ±‚å€¼â€æŠŠè¿™äº›å…¬å¼è¯†åˆ«å‡ºæ¥
  * æ›¿æ¢å›åŸæœ¬çš„ç®€å•è¿ç®—
  * ç»“åˆ `instcombine`ã€`simplifycfg` å†è·‘ä¸€é

å¯ä»¥å‚è€ƒä¸€äº›å…¬å¼€çš„ LLVM / WebAssembly MBA æ··æ·†è®¨è®ºå’Œå®ç°ã€‚([arXiv][4])

---

### 4ï¸âƒ£ Procedure Merging / Function Mergingï¼ˆå‡½æ•°åˆå¹¶ï¼‰

Junod è®ºæ–‡å’Œéƒ¨åˆ† LLVM obfuscator é¡¹ç›®ä¼šæŠŠå¤šä¸ªå‡½æ•°åˆæˆä¸€ä¸ªå¤§å‡½æ•°ï¼Œé€šè¿‡ä¸€ä¸ªå‚æ•°/çŠ¶æ€æ¥å†³å®šæ‰§è¡Œå“ªä¸€æ®µã€‚([Pascal Junod][1])

* âœ… æ··æ·† Passï¼š

  * æŠŠå¤šä¸ªå‡½æ•° â€œé“ºå¹³â€ åˆ°ä¸€ä¸ªå¤§å‡½æ•°ä¸­
  * ç”¨ `switch(tag)` æˆ– if é“¾å†³å®šè°ƒç”¨å“ªä¸€æ®µ body
  * è°ƒç”¨ç‚¹å˜æˆï¼šä¼  `tag` + å‚æ•°

* âœ… åæ··æ·†æ€è·¯ï¼š

  * è¯†åˆ«è¿™ä¸ª mega-function çš„â€œtag åˆ†å‘æ¨¡å¼â€
  * æŒ‰ tag æ‹†å›å¤šä¸ªå‡½æ•°ï¼ˆæ–°å»º Functionï¼Œclone å¯¹åº” BBï¼‰
  * æ›´æ–°è°ƒç”¨ç‚¹ï¼Œæ¢å¤ä¸ºæ­£å¸¸ `call fX(...)`

è¿™ä¸ªæ¨¡å¼æœ¬è´¨ä¸Šå°±æ˜¯â€œæ‰‹å†™å¤šæ€/è™šå‡½æ•°è¡¨â€ï¼Œä¹‹å VMP é‡Œä¹Ÿç»å¸¸å˜ç§ä½¿ç”¨ã€‚

---

### 5ï¸âƒ£ Basic Block Splitting & Code Layout Tricksï¼ˆåŸºæœ¬å—æ‹†åˆ†/é‡æ’ï¼‰

* åŸºæœ¬å—æ‹†å¾—éå¸¸ç¢
* æŠŠé€»è¾‘äº¤é”™åœ¨ä¸€èµ·
* æ’å…¥æ— æ•ˆè·³è½¬ï¼Œå†é€šè¿‡ `fallthrough` å®ç°çœŸå®é€»è¾‘

**ç»ƒä¹ ï¼š**

* å†™ä¸€ä¸ªç®€å•æ‹†å— Passï¼š

  * æŠŠä¸€ä¸ª BB æ‹†æˆå¤šæ®µ BBï¼Œæ’å…¥å†—ä½™è·³è½¬
* å†™ä¸€ä¸ªâ€œåˆå¹¶ç¢å—â€çš„åæ··æ·† Passï¼š

  * å¦‚æœä¸€ä¸ª BB æ— æ¡ä»¶è·³å‘å”¯ä¸€åç»§ï¼Œä¸”æ— å‰¯ä½œç”¨ï¼Œå°±åˆå¹¶å®ƒä»¬

è¿™ç­‰ä»·äºï¼šå…ˆå†™ä¸€ä¸ªâ€œæ‰‹åŠ¨æ‹†å—ç‰ˆ flattenâ€ï¼Œå†å†™ä¸€ä¸ª `simplifycfg` çš„è¶…é›†ã€‚

---

### 6ï¸âƒ£ Tamper-proofing / Integrity Checkï¼ˆç®€å•ç‰ˆï¼‰

è®ºæ–‡é‡Œæåˆ°äº†åŸºäº checksum çš„é˜²ç¯¡æ”¹æœºåˆ¶ï¼š([Pascal Junod][1])

* åœ¨ CFF backbone ä¸­æ’å…¥ï¼š

  * å¯¹ä»£ç /å¸¸é‡/æ•°æ®åš hash/checksum
  * æ ¡éªŒå¤±è´¥å°±èµ°å¼‚å¸¸è·¯å¾„æˆ–å´©æºƒ

ä½ å¯ä»¥å®ç°ä¸€ä¸ªâ€œå°è€Œç¾â€çš„ç‰ˆæœ¬ï¼š

* æ··æ·† Passï¼š

  * å¯¹æŸäº›å‡½æ•°æ’å…¥ â€œè‡ªæ ¡éªŒâ€ block
* åæ··æ·† Passï¼š

  * åˆ é™¤è¿™äº›æ ¡éªŒé€»è¾‘ï¼Œæˆ–æŠŠåˆ†æ”¯æ”¹æˆç›´æ¥é€šè¿‡

ä½ ä¸éœ€è¦åšå¾—åƒå•†ä¸šä¿æŠ¤å£³é‚£æ ·å¤æ‚ï¼Œåªè¦çŸ¥é“â€œåŸç† + åæ··æ·†ç­–ç•¥â€å°±å¤Ÿã€‚

---

## ğŸ¥ˆ é˜¶æ®µäºŒï¼šæ‰©å±•å‹ LLVM æ··æ·†ï¼ˆå­—ç¬¦ä¸²ã€å¸¸é‡ã€æŠ—åˆ†æç­‰ï¼‰

è¿™ä¸€æ­¥çš„ç›®æ ‡æ˜¯ï¼š**æŠŠå¸¸è§çš„â€œé VMP æ··æ·†å¥—è·¯â€åœ¨ LLVM å±‚é¢éƒ½ç©ä¸€é**ï¼Œä»¥ååœ¨äºŒè¿›åˆ¶é‡Œçœ‹åˆ°å°±ä¸ä¼šæ…Œã€‚

è¿™é‡Œå‚è€ƒä¸€äº› OLLVM fork / æ–°ä¸€ä»£ç†è®ºï¼Œæ¯”å¦‚ Hikariã€O-MVLLã€ç‹¬ç«‹ string obfuscator é¡¹ç›®ç­‰ã€‚([GitHub][5])

---

### A. å­—ç¬¦ä¸² / å¸¸é‡åŠ å¯†ï¼ˆString / Constant Obfuscationï¼‰

å¸¸è§æ¨¡å¼ï¼š

* ç”¨ XOR/ADD/å¤šé¡¹å¼/MBA å¯¹å­—ç¬¦ä¸²ç¼–ç 
* åœ¨ç¨‹åºåˆå§‹åŒ–æˆ–ä½¿ç”¨å‰åŠ¨æ€è§£å¯†
* æŠŠåŸå§‹å­—ç¬¦ä¸²ä»åªè¯»æ®µæ¸…é™¤

**ä½ å¯ä»¥åšï¼š**

* æ··æ·† Passï¼š

  * æšä¸¾å…¨å±€å­—ç¬¦ä¸² & å­—ç¬¦ä¸²å¸¸é‡
  * ç”ŸæˆåŠ å¯†ç‰ˆæœ¬ï¼ˆå¦‚ XOR keyï¼Œæˆ–ç®€å•å¤šé¡¹å¼ï¼‰
  * æ’å…¥è§£å¯†å‡½æ•°ï¼Œåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å‰è§£å¯†åˆ°å †/æ ˆ

* åæ··æ·† Passï¼š

  * é™æ€æ‰§è¡Œ or æ¨¡æ‹Ÿè§£å¯†å‡½æ•°ï¼ˆIR å±‚ï¼‰
  * ç›´æ¥æŠŠå¯†æ–‡è¿˜åŸæˆæ˜æ–‡ï¼Œæ›¿æ¢ IR ä¸­çš„ load
  * æŠŠè§£å¯†é€»è¾‘æ ‡è®°ä¸º dead codeï¼Œäº¤ç»™ DCE æ¸…æ‰

å¯ä»¥å‚è€ƒï¼š

* OMVLL çš„ `Strings Encoding` pass([Obfuscator][6])
* å¼€æºçš„ LLVM string obfuscator é¡¹ç›®ï¼ˆtsarpaul çš„é‚£ä¸ªï¼‰([GitHub][7])

---

### B. æ›´èŠ±çš„ Control-flow Tricksï¼ˆCFF å˜ç§ç­‰ï¼‰

æ¯”å¦‚ï¼š

* ä¸æ˜¯å•ä¸€ `switch(state)`ï¼Œè€Œæ˜¯å¤šå±‚ state / åŒçŠ¶æ€æœº
* ç”¨ç®—æœ¯/åŠ å¯†å‡½æ•°æ¥è®¡ç®—ä¸‹ä¸€ä¸ª state
* æ’å…¥å¤šçº§ dispatcherã€åµŒå¥— flattening

å‚è€ƒï¼š

* OMVLL çš„ CFF æ–‡æ¡£([Obfuscator][2])
* å„ç§åšå®¢é‡Œâ€œè‡ªå·±å†™ CFF passâ€çš„æ¡ˆä¾‹([Lodsb][8])

**ä½ çš„ç›®æ ‡ï¼š**

* åœ¨ IR å±‚è¯•ç€æŠŠ CFF å¤æ‚åŒ–ä¸€ç‚¹ï¼ˆæ¨¡æ‹ŸçœŸå®æ··æ·†å™¨ï¼‰
* ç„¶åä¾ç„¶å†™å¾—å‡ºåæ··æ·† Pass èƒ½æŠŠå®ƒæ°ç›´

---

### C. é«˜çº§ Opaque Predicatesï¼ˆä¸æ­¢æ˜¯ x*3 == x+x+xï¼‰

å‚è€ƒä¸€äº› anti-disassembly / anti-static-analysis æŠ€å·§ï¼š([0xPat][9])

* åŸºäºæ•°å­¦æ’ç­‰å¼ã€æ•°è®ºæ€§è´¨
* åŸºäºå…¨å±€/å±€éƒ¨çŠ¶æ€ï¼ˆåªè¯»ä½†éš¾åˆ†æï¼‰
* åˆ©ç”¨ç¯ç»“æ„ã€ä½è¿ç®—æ„é€ æ’çœŸè¡¨è¾¾å¼

**ç»ƒä¹ ï¼š**

* å†™ä¸€ä¸ª Pass ç”Ÿæˆå¤šç§ Opaque Predicate æ¨¡æ¿
* å†å†™ä¸€ä¸ªåæ··æ·† Pass é’ˆå¯¹æ¯ç§æ¨¡æ¿åšæ¨¡å¼è¯†åˆ«æˆ– SMT æ±‚è§£

---

### D. å¸ƒå±€ / åè°ƒè¯• / ååç¼–è¯‘ å°æŠ€å·§

è¿™äº›ä¸ä¸€å®šéƒ½æ˜¯ LLVM passï¼Œä½†å¯ä»¥é¡ºæ‰‹ç©ï¼š

* inline / outline å‡½æ•°
* æŠŠçŸ­å‡½æ•°åˆå¹¶åˆ°è°ƒç”¨ç‚¹ï¼ˆå†…è”æˆåƒåœ¾ï¼‰
* æ’å…¥ä¸ä¼šè§¦å‘ä½†å“å”¬äººçš„ API è°ƒç”¨ï¼ˆä¾‹å¦‚ `ptrace` æ£€æµ‹ï¼‰
* æ’å…¥ anti-disassembly patternï¼ˆç‰¹åˆ«æ˜¯åœ¨æŸäº› arch ç‰¹å®šæŒ‡ä»¤åºåˆ—ä¸Šï¼‰([0xPat][9])

è¿™äº›ä¸œè¥¿åœ¨ VMP å¤–å£³é‡Œä¹Ÿç»å¸¸å’Œè™šæ‹ŸåŒ–ä¸€èµ·å‡ºç°ï¼Œå…ˆåœ¨å¹²å‡€çš„ LLVM ä¸–ç•Œé‡Œä½“éªŒä¸€ééå¸¸å¥½ã€‚

---

## ğŸ¥‰ é˜¶æ®µä¸‰ï¼šä» IR çœ‹ Binary â€”â€” ä¸º VMP åšâ€œç¯å¢ƒé€‚åº”è®­ç»ƒâ€

ä½ æœ€ç»ˆè¦åœ¨ **äºŒè¿›åˆ¶å±‚é¢å¯¹ VMP åšåè™šæ‹ŸåŒ–**ï¼Œæ‰€ä»¥åœ¨ä¸Š VMP ä¹‹å‰ï¼Œå»ºè®®ä½ åšä¸€ä¸ªâ€œä¸­é—´è¿‡æ¸¡â€ï¼š

> **å…ˆæ‹¿ OLLVM æ··æ·†è¿‡çš„ç¨‹åºï¼Œåœ¨äºŒè¿›åˆ¶å±‚åšä¸€æ¬¡å»æ··æ·†ï¼ˆéƒ¨åˆ†è‡ªåŠ¨åŒ–ï¼‰**ã€‚

å¯ä»¥å‚è€ƒ Quarkslab é‚£ç¯‡ç»å…¸çš„ â€œDeobfuscation: recovering an OLLVM-protected programâ€ å’Œä¸€äº›åŸºäº Binary Ninja / Ghidra çš„è‡ªåŠ¨å» OLLVM å®æˆ˜æ–‡ç« ã€‚([Quarkslab Blog][10])

### å¯ä»¥è¿™æ ·ç»ƒï¼š

1. ç”¨ä½ çš„ OLLVM Pass æ··æ·†ä¸€ä¸ªå°ç¨‹åº
2. ç¼–è¯‘æˆ ELF / Mach-O / PE
3. åœ¨ Ghidra / IDA / BN ä¸­è§‚å¯Ÿ CFF / BCF / SUB åœ¨äºŒè¿›åˆ¶å±‚çš„å½¢æ€
4. å†™ä¸€ç‚¹ **è„šæœ¬çº§å»æ··æ·†**ï¼š

   * Python + Ghidra script / IDAPython
   * æˆ– angr åš CFG æ¢å¤ / ç¬¦å·æ‰§è¡Œç®€åŒ–

è¿™æ ·ä½ ä¼šå»ºç«‹ä¸€ä¸ªéå¸¸å®è´µçš„ç›´è§‰ï¼š

> â€œå“¦ï¼ŒåŸæ¥ IR é‡Œå¹³å¦åŒ–çš„ä¸œè¥¿ï¼Œç¼–è¯‘æˆæœºå™¨ç åé•¿è¿™æ ·ï¼›
> ä»¥å VMP è™šæ‹Ÿæœºé‡Œçš„é‚£ç§ä¹±ä¸ƒå…«ç³Ÿæ§åˆ¶æµï¼Œå…¶å®å°±æ˜¯æ›´æ®‹æš´ç‰ˆçš„è¿™ä¸€å¥—ã€‚â€

---

## âœ… æœ€åå¸®ä½ åšä¸ªâ€œæ‰“å‹¾è¡¨â€

ä½ å¯ä»¥ç›´æ¥æ‹¿è¿™ä¸ªå½“ roadmapï¼Œç”¨ä¸€ä¸¤ä¸ªæœˆæ…¢æ…¢å•ƒï¼š

### é˜¶æ®µ 1ï¼šç»å…¸ OLLVMï¼ˆå¿…é¡»å…¨ä¼šï¼‰

* [ ] IR çº§ CFF å®ç° + de-CFF Pass
* [ ] IR çº§ BCF å®ç° + de-bogus Pass
* [ ] IR çº§ Instruction Sub / MBA + de-MBA Pass
* [ ] å‡½æ•°åˆå¹¶ï¼ˆprocedure mergingï¼‰+ æ‹†å›å¤šå‡½æ•°
* [ ] åŸºæœ¬å—æ‹†åˆ† + è‡ªåŠ¨åˆå¹¶ç¢å—
* [ ] ç®€æ˜“å®Œæ•´æ€§æ ¡éªŒ + ç§»é™¤æ ¡éªŒé€»è¾‘

### é˜¶æ®µ 2ï¼šæ‰©å±•æ··æ·†ï¼ˆå»ºè®®å¤§éƒ¨åˆ†ä¼šï¼‰

* [ ] å­—ç¬¦ä¸²åŠ å¯† / å¸¸é‡åŠ å¯† + é™æ€è§£å¯†è¿˜åŸ
* [ ] CFF å˜ç§ï¼ˆå¤š stateã€å¤š dispatcherï¼‰+ å¯¹åº” de-CFF
* [ ] å¤šç§ Opaque Predicate æ¨¡æ¿ + è‡ªåŠ¨è¯†åˆ«/æ¶ˆé™¤
* [ ] ç®€å• anti-disassembly / anti-debug trickï¼ˆäº†è§£å³å¯ï¼‰

### é˜¶æ®µ 3ï¼šBinary è¿‡æ¸¡ï¼ˆä¸º VMP é¢„çƒ­ï¼‰

* [ ] èƒ½ç”¨è‡ªå·±çš„ OLLVM pass æ··æ·†ä¸€ä¸ªçœŸå®é¡¹ç›®ï¼ˆC/C++/Rust éƒ½è¡Œï¼‰
* [ ] èƒ½åœ¨ Ghidra / IDA / BN ä¸­è®¤å‡º CFF/BCF/SUB/å­—ç¬¦ä¸²åŠ å¯†
* [ ] èƒ½å†™ç®€å•è„šæœ¬åœ¨äºŒè¿›åˆ¶å±‚åšâ€œåŠè‡ªåŠ¨å» OLLVMâ€
* [ ] èƒ½ç”¨ angr / å…¶å®ƒæ¡†æ¶åšä¸€ç‚¹ç®€å•ç¬¦å·æ‰§è¡Œ + CFG æ¸…æ´—

å½“è¿™äº›ä½ éƒ½æ¯”è¾ƒç†Ÿä¹‹åï¼Œå†çœ‹ VMPï¼š

* è™šæ‹Ÿæœºå­—èŠ‚ç 
* handler æ··æ·†
* çŠ¶æ€æœºæ§åˆ¶æµ
* MBA æ·±åº¦å˜å½¢

ä½ ä¼šå‘ç°ï¼š**å¾ˆå¤šåŸç†ä½ åœ¨ OLLVM é˜¶æ®µå·²ç»ç»ƒè¿‡ä¸€éï¼Œåªæ˜¯ä»å¹²å‡€çš„ LLVM IR æ¢æˆäº†è„ binary + è‡ªå®šä¹‰ ISAã€‚**

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥å¸®ä½ ï¼š

* ç»™å‡ºä¸€ä»½ **â€œde-CFF Pass è¯¦ç»†è®¾è®¡æ–‡æ¡£â€**ï¼ˆæ€ä¹ˆè¯†åˆ« dispatcherã€å¦‚ä½•æ¢å¤ CFGï¼‰
* æˆ–è€…ä¸€ä»½ **â€œè‡ªå·±çš„ OLLVM æ··æ·† + åæ··æ·† Pass å·¥ç¨‹ç»“æ„â€ ç¤ºä¾‹**
* æˆ–è€…ä»ä¸Šé¢çš„ checklist é‡ŒæŒ‘ä¸€é¡¹ï¼Œæˆ‘å¸®ä½ æ‹†æˆæ›´ç»†çš„å­ä»»åŠ¡ï¼ˆæ¯”å¦‚ä¸€å‘¨è®¡åˆ’ï¼‰

ä½ æ›´æƒ³å…ˆåŠ¨å“ªä¸€å—ï¼Ÿ

[1]: https://crypto.junod.info/spro15.pdf?utm_source=chatgpt.com "Obfuscator-LLVM â€” Software Protection for the Masses"
[2]: https://obfuscator.re/omvll/passes/control-flow-flattening/?utm_source=chatgpt.com "Control-Flow Flattening | O-MVLL Documentation"
[3]: https://github.com/obfuscator-llvm/obfuscator/wiki/Bogus-control-flow?utm_source=chatgpt.com "Bogus Control Flow"
[4]: https://arxiv.org/html/2403.15197v1?utm_source=chatgpt.com "WebAssembly Obfuscation for Evading Cryptojacking ..."
[5]: https://github.com/HikariObfuscator/Hikari/wiki?utm_source=chatgpt.com "Home Â· HikariObfuscator/Hikari Wiki"
[6]: https://obfuscator.re/omvll/passes/strings-encoding/?utm_source=chatgpt.com "Strings Encoding | O-MVLL Documentation"
[7]: https://github.com/tsarpaul/llvm-string-obfuscator?utm_source=chatgpt.com "tsarpaul/llvm-string-obfuscator"
[8]: https://www.lodsb.com/control-flow-flattening-how-to-build-your-own?utm_source=chatgpt.com "Control Flow Flattening: How to build your own - LODSB"
[9]: https://0xpat.github.io/Malware_development_part_6/?utm_source=chatgpt.com "advanced obfuscation with LLVM and template ... - 0xPat blog"
[10]: https://blog.quarkslab.com/deobfuscation-recovering-an-ollvm-protected-program.html?utm_source=chatgpt.com "Deobfuscation: recovering an OLLVM-protected program"
